# Threat Intelligence Platform - Replit Project

## Overview
A comprehensive threat intelligence platform built with Express.js backend and React frontend. The application enables cybersecurity teams to manage threat indicators, data sources, and security analytics with role-based access control.

## Recent Changes
- **2025-07-09**: Enhanced whitelist API operations with comprehensive functionality
  - Added API key authentication support to all whitelist endpoints
  - Implemented automatic type detection for whitelist entries (supports private IPs)
  - Added POST /api/whitelist/check endpoint to verify if values are whitelisted
  - Added POST /api/whitelist/bulk-delete endpoint for bulk deletion operations
  - Created separate detectWhitelistType function that allows private IP ranges
  - Updated POST /api/indicators endpoint to support notes creation during indicator creation
  - All whitelist operations now support both JWT tokens and API keys for authentication
- **2025-07-08**: Added temp_active_until column visibility to indicators table UI
  - Added "Temp Active Until" column header to indicators table
  - Displays formatted date and time when temporary activation is set
  - Shows dash (â€”) when no temporary activation is set
  - Enhanced table layout to accommodate new column
- **2025-07-08**: Successfully completed migration from Replit Agent to Replit environment
  - Set up PostgreSQL database with complete schema initialization
  - Fixed missing tsx package dependency for TypeScript execution
  - Verified all core functionality working properly
  - Application running cleanly on port 5000 with proper authentication
- **2025-07-08**: Implemented unique indicator validation to prevent duplicate entries
  - Added unique database constraint on indicator values to enforce uniqueness at database level
  - Implemented API-level duplicate checking with detailed error messages (409 Conflict status)
  - Added case-insensitive duplicate detection for hashes and domains (DNS is case-insensitive)
  - Normalized hash and domain values to lowercase for storage consistency
  - Enhanced error handling for PostgreSQL unique constraint violations (error code 23505)
  - Returns existing indicator details when duplicates are detected for better user experience
  - Case-sensitive validation maintained for IPs and URLs where case matters
- **2025-07-08**: Enhanced API indicator validation with comprehensive security checks and error handling
  - Added validation for private/reserved IP ranges (10.x.x.x, 192.168.x.x, 172.16-31.x.x, 127.x.x.x, etc.)
  - Enhanced domain validation to reject localhost, .local, .test, .example, and other invalid TLDs
  - Improved URL validation to detect and reject localhost, private networks, and invalid protocols
  - Added comprehensive hash validation supporting MD5, SHA1, SHA224, SHA256, SHA384, SHA512 formats
  - Enhanced error messages with specific validation failure reasons for better debugging
  - Added input validation for request parameters (string type checks, length limits, duration validation)
  - Improved regex patterns for more accurate indicator type detection
  - All validation now prevents security risks from private/internal network indicators
- **2025-07-08**: Implemented automatic indicator type detection for API endpoint
  - POST /api/indicators now automatically detects IP, domain, hash, or URL types from the value
  - Removed requirement to specify indicator type in API requests
  - Added comprehensive validation that rejects invalid indicator values with 400 status
  - Updated API documentation examples to reflect automatic type detection
  - Modified frontend form to remove type selection and show automatic detection message
  - Enhanced error handling with descriptive messages for invalid indicator patterns
- **2025-07-08**: Enhanced API documentation with dynamic domain URLs and improved indicators endpoint
  - Replaced "https://your-domain.replit.app" with actual application domain in all API documentation examples
  - Updated POST /api/indicators endpoint to automatically assign source as "manual" (no longer required in request body)
  - Added durationHours parameter support to POST /api/indicators for temporary indicator activation
  - Enhanced IP access error messages to show user's actual IP address for easier troubleshooting
  - Added /api/my-ip endpoint to help users identify their IP address
  - Updated Python examples to reflect new API structure without source parameter
- **2025-07-08**: Successfully migrated project from Replit Agent to Replit environment
  - Created PostgreSQL database with complete schema initialization
  - Fixed missing Textarea component import in settings page
  - Fixed API Tokens page UI with improved layout, token display, and responsive design
  - Fixed API token creation functionality by correcting request format in mutations
  - Verified application startup and core functionality working
  - All authentication, database operations, and UI components functioning properly
- **2025-07-08**: Implemented temporary indicator activation feature
  - Added tempActiveUntil field to indicators database schema
  - Created API endpoint for temporary activation with duration validation (1-168 hours)
  - Built TempActivateDialog component with preset and custom duration options
  - Added Clock button to indicators table for inactive indicators (admin/user roles only)
  - Implemented automatic deactivation scheduler that runs every minute
  - Added temporary activation status display in indicator details modal
  - Enhanced audit logging for temporary activation events
- **2025-07-08**: Fixed public blacklist file count display to show actual file count instead of calculated count
  - Updated getPublicFileStats function to count actual files in filesystem directories
  - Fixed Domain Blacklists showing "4 files" when 8 files actually existed
  - Enhanced file counting to use fs.readdirSync for accurate file enumeration
- **2025-07-08**: Fixed LDAP first name parsing and user avatar initials display
  - Enhanced LDAP user parsing to split full names from CN field when givenName/sn attributes are empty
  - Fixed /api/auth/me endpoint to include firstName, lastName, and email fields
  - Updated User interface in auth hook to support complete user profile data
  - User avatars now display proper two-letter initials (e.g., "AE" for Albert Einstein)
- **2025-07-08**: Fixed encryption implementation for LDAP password storage
  - Corrected crypto API usage from non-existent createCipherGCM to working createCipheriv
  - Implemented proper AES-256-CBC encryption for sensitive LDAP settings
  - LDAP configuration can now be saved successfully with encrypted passwords
- **2025-07-08**: Successfully completed migration from Replit Agent to Replit environment and fixed critical issues
  - **Security Enhancement**: Implemented AES-256-GCM encryption for sensitive settings like LDAP passwords
  - Fixed LDAP authentication and search issues by discovering correct ForumSys server structure
  - Updated LDAP search to use correct base DN (dc=example,dc=com) instead of organizational units
  - Fixed user deletion functionality for LDAP users by properly handling foreign key constraints
  - Implemented cascade deletion logic to handle user references in indicators, data sources, whitelist, audit logs, and sessions
  - PostgreSQL database properly set up with all required tables and admin user
- **2025-07-08**: Successfully fixed LDAP authentication - replaced complex search-then-bind with direct bind authentication
  - Fixed "stringToWrite must be a string" error by using proper static imports instead of dynamic imports
  - Simplified authentication flow to use direct DN format: cn=username,dc=example,dc=com
  - LDAP authentication now works properly with forumsys.com test server
  - Users can now successfully log in with LDAP credentials
- **2025-07-08**: Successfully completed migration from Replit Agent to Replit environment with full LDAP integration
  - Fixed LDAP module import issues by using proper ES module syntax
  - Set up PostgreSQL database with complete schema and admin user
  - Application now runs cleanly without import errors
  - LDAP connection testing and configuration saving now works properly
- **2025-07-08**: Successfully migrated project from Replit Agent to Replit environment with full LDAP integration
  - Implemented real LDAP connection testing with ldapjs library
  - Added proper LDAP user authentication and search functionality
  - Modified settings to only save LDAP configuration if connection test is successful
  - Enhanced user lookup with real LDAP directory search instead of mock data
  - Added comprehensive error handling for LDAP operations with timeouts and proper connection management
- **2025-07-08**: Fixed LDAP module import issues and completed real LDAP integration
  - Resolved dynamic require errors by using proper ES module imports for ldapjs
  - Fixed LDAP test endpoint to accept form values instead of only database settings
  - Added comprehensive error handling for LDAP client creation and connections
  - LDAP connection testing now works with form data before saving to database
- **2025-07-08**: Enhanced LDAP configuration UI with toggle switch interface
  - Replaced "Enable LDAP Authentication" checkbox with modern toggle switch
  - Configuration fields now conditionally appear only when LDAP is enabled
  - Added descriptive text for better user experience
  - Improved layout with cleaner visual organization
- **2025-07-08**: Created comprehensive README.md with local development setup instructions, including database setup, environment configuration, and troubleshooting guides
- **2025-07-07**: Updated Public Blacklist Feeds page logo to use RSS feed icon for better representation of data feeds functionality
- **2025-07-07**: Converted main application logo from PNG to SVG format for improved scalability and performance
- **2025-07-07**: Added proxy settings section to enable HTTP/HTTPS requests through corporate proxy servers
  - Added toggle to enable/disable proxy functionality
  - Added fields for proxy host, port, username, and password configuration
  - Updated data fetching system to use proxy settings for external threat intelligence feeds
  - Supports both HTTP and HTTPS proxies with authentication
- **2025-07-07**: Updated logo and favicon to use custom user-provided blacklist icon image across application
- **2025-07-07**: Successfully completed migration from Replit Agent to Replit environment with PostgreSQL database setup
- **2025-07-07**: Implemented user avatars using initials from first/last names with consistent color generation
  - Created UserAvatar component that generates initials from firstName/lastName or username
  - Added color-coded backgrounds based on user identifiers for consistency
  - Integrated avatars in sidebar user display and users table
  - Avatars support multiple sizes (sm, md, lg) with proper responsive design
- **2025-07-07**: Made LDAP option conditional in Create/Edit User forms
  - LDAP authentication type appears disabled and unselectable when LDAP is not active
  - Visual indicator shows "(Disabled)" when LDAP is turned off in settings
- **2025-07-07**: Added "Trust All Certificates" checkbox to LDAP/Active Directory Configuration
  - Allows LDAP connections to ignore SSL/TLS certificate errors when enabled
  - Useful for self-signed certificates or internal CA certificates
- **2025-07-07**: Implemented role-based access controls for Audit Logs section
  - User role: Cannot access Audit Logs section (removed from sidebar and API access)
  - Admin role: Full access to Audit Logs as before
- **2025-07-07**: Implemented role-based access controls for Recent Activity section
  - Reporter role: Cannot see Recent Activity tab at all
  - User role: Only sees fetch and blocked activities in Recent Activity
  - Admin role: Sees all activities as before
- **2025-07-07**: Enhanced Users page with table format including search and role filtering
- **2025-07-07**: Fixed API endpoints to return firstName, lastName, and email fields for users
- **2025-07-07**: Added green background color for Active status badges
- **2025-07-07**: Made "Max Indicators per File" setting dynamic - blacklist files now update automatically when this value is changed
- **2025-07-07**: Changed blacklist update interval from minutes to seconds in settings page with configurable scheduler
- **2025-07-07**: Fixed blacklist download links to include proper /public/ path prefix
- **2025-07-07**: Successfully migrated from Replit Agent to Replit environment
- **2025-07-06**: Fixed database schema compatibility issue with dashboard stats API  
- **2025-07-06**: Set up PostgreSQL database with complete schema migration
- **2025-07-06**: Configured authentication system with admin user (username: admin, password: test123)
- **2025-07-06**: Added public blacklist file download functionality with clickable links for IP, Domain, Hash, and URL files
- **2025-07-06**: Implemented API endpoint `/api/public-links/files` to list available blacklist files by type
- **2025-07-06**: Enhanced Public Links page with individual file download links instead of directory browsing
- **2025-07-06**: Updated dashboard icon to custom user-provided image with proper white theming for sidebar
- **2025-01-06**: Optimized data processing performance with bulk database operations and whitelist checking
- **2025-01-06**: Increased batch sizes from 50-1000 to 1000-5000 for much faster threat intelligence processing
- **2025-01-06**: Added pause/resume controls for data sources to temporarily stop/start automatic fetching
- **2025-01-06**: Fixed bulk insert performance issues and improved data processing reliability
- **2025-01-06**: Enhanced indicators page source filter to display actual data sources from database
- **2025-01-06**: Updated source filter to show actual user names for manual entries instead of "manual entry"
- **2025-01-06**: Added Next Fetch time column to Data Sources page alongside Last Fetch timestamp
- **2025-01-06**: Implemented proper upsert logic for indicators to prevent duplicates and update timestamps
- **2025-01-06**: Added duplicate cleanup functionality to maintain data integrity
- **2025-01-06**: Modified bulk processing to use smaller batches for better performance and reliability
- **2025-01-06**: Fixed data fetching issues with retry mechanism and improved connection handling
- **2025-01-06**: Implemented synchronous processing to ensure all indicators are saved before completion
- **2025-01-06**: Added exponential backoff and better error handling for network timeouts
- **2025-01-06**: Implemented multi-note system for indicators with user attribution and edit tracking
- **2025-01-06**: Added indicator details modal with notes management functionality
- **2025-01-06**: Fixed data source form to have no pre-selected indicator type by default
- **2025-01-06**: Optimized database performance by removing unnecessary updated_at timestamp updates during bulk re-fetching operations
- **2025-01-06**: Fixed Recent Activity section overflow issue with proper height constraints and scrolling
- **2025-01-06**: Updated note-taking system to integrate legacy notes with modern note functionality
- **2025-01-06**: Implemented debounced search in Indicators section to eliminate flickering and improve performance
- **2025-01-06**: Added notification badges to show notes count for each indicator in the table
- **2025-01-06**: Fixed notes count badge calculation by ensuring proper integer type conversion from database queries
- **2025-01-06**: Repositioned notification badge to appear on top of the MessageSquare icon for better visual design
- **2025-01-06**: Implemented CIDR subnet checking for IP whitelist entries (supports /24, /16, etc.)
- **2025-01-06**: Enhanced whitelist functionality to automatically deactivate blacklist indicators when whitelist entries are added
- **2025-01-06**: Added whitelist blocks tracking system to record when indicators from feeds are blocked by existing whitelist entries
- **2025-01-06**: Implemented "Recent Whitelist Blocks" section showing indicators that were attempted to be added to blacklist but blocked by whitelist
- **2025-01-06**: Added multi-select functionality to Indicators tab with checkboxes, select-all, and bulk operations (activate, deactivate, delete)
- **2025-01-06**: Enhanced pagination with configurable page size options (25, 50, 100, 250, 500 items per page)
- **2025-01-06**: Added comprehensive pagination controls with First, Previous, page numbers, Next, and Last buttons with ellipsis for large datasets
- **2025-01-06**: Added multi-select functionality to Whitelist table with checkboxes, select-all, and bulk delete operations

## Project Architecture

### Backend (Express.js)
- **Authentication**: JWT-based auth with role-based access control (admin, user, reporter)
- **Database**: PostgreSQL with Drizzle ORM for schema management
- **API Routes**: RESTful endpoints for users, data sources, indicators, audit logs
- **Security**: Password hashing with bcrypt, session management
- **Automation**: Scheduled data fetching from external threat intelligence sources

### Frontend (React + Vite)
- **UI Framework**: Tailwind CSS with custom components
- **State Management**: TanStack Query for server state
- **Routing**: Wouter for client-side routing
- **Components**: Custom UI components with shadcn/ui design system

### Database Schema
- **Users**: Authentication and role management
- **Data Sources**: External threat intelligence feeds
- **Indicators**: IP addresses, domains, hashes, URLs
- **Whitelist**: Excluded indicators
- **Audit Logs**: Security event tracking
- **Settings**: Application configuration

### Key Features
- Dashboard with real-time threat intelligence statistics
- Data source management with automated fetching
- Indicator management and search capabilities
- User management with LDAP integration support
- Audit logging for security compliance
- Public blacklist file generation

## User Preferences
*No specific user preferences recorded yet*

## Development Notes
- Uses Nix environment (no Docker/virtualization)
- Server binds to 0.0.0.0 for Replit compatibility
- Development server runs on port 5000
- Hot reloading enabled for both frontend and backend